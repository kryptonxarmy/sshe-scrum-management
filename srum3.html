<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskBoard - SHE Department</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            display: flex;
        }
        
        .sidebar {
            width: 260px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 100;
            overflow-y: auto;
        }
        
        .sidebar-header {
            background: linear-gradient(135deg, #0066cc, #004080);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        .sidebar-header h1 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }
        
        .sidebar-header .subtitle {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-bottom: 0.2rem;
        }
        
        .sidebar-header .system-info {
            font-size: 0.7rem;
            opacity: 0.8;
        }
        
        .sidebar-nav {
            padding: 1rem 0;
        }
        
        .nav-section {
            margin-bottom: 1.5rem;
        }
        
        .nav-section-title {
            padding: 0.5rem 1.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: #374151;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: #f8fafc;
            color: #0066cc;
        }
        
        .nav-item.active {
            background: #eff6ff;
            color: #0066cc;
            border-left-color: #0066cc;
            font-weight: 500;
        }
        
        .nav-item-icon {
            margin-right: 0.75rem;
            width: 18px;
            text-align: center;
        }
        
        .nav-item-count {
            margin-left: auto;
            background: #e5e7eb;
            color: #6b7280;
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .nav-item.active .nav-item-count {
            background: #dbeafe;
            color: #0066cc;
        }
        
        .main-content {
            flex: 1;
            margin-left: 260px;
            min-height: 100vh;
        }
        
        .header {
            background: white;
            color: #1e293b;
            padding: 1.5rem 2rem;
            text-align: left;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom: 1px solid #e2e8f0;
        }
        
        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: #1e293b;
        }
        
        .header .subtitle {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .nav-tabs {
            background: white;
            padding: 0 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom: 1px solid #e2e8f0;
        }
        
        .tab-list {
            display: flex;
            gap: 2rem;
            list-style: none;
        }
        
        .tab-item {
            padding: 1rem 0;
            cursor: pointer;
            color: #64748b;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-item:hover,
        .tab-item.active {
            color: #0066cc;
            border-bottom-color: #0066cc;
        }
        
        .tab-icon {
            margin-right: 0.5rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .function-section {
            display: none;
        }
        
        .function-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .create-task-btn {
            background: #0066cc;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .create-task-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .kanban-column {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .column-header {
            font-weight: 600;
            color: #374151;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }
        
        .todo-header { border-bottom-color: #ef4444; }
        .progress-header { border-bottom-color: #f59e0b; }
        .done-header { border-bottom-color: #10b981; }
        
        .task-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .task-card:hover {
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .task-card:active {
            cursor: grabbing;
        }
        
        .task-type-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .badge-spike { background: #fef3c7; color: #d97706; }
        .badge-story { background: #dbeafe; color: #1d4ed8; }
        .badge-sprint { background: #d1fae5; color: #059669; }
        .badge-qa { background: #fee2e2; color: #dc2626; }
        
        .task-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
            margin-right: 60px;
        }
        
        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #64748b;
        }
        
        .task-priority {
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .priority-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .priority-medium {
            background: #fef3c7;
            color: #d97706;
        }
        
        .priority-low {
            background: #d1fae5;
            color: #059669;
        }
        
        .team-performance {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .performance-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .empty-state {
            text-align: center;
            color: #64748b;
            padding: 2rem;
        }
        
        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .form-textarea {
            resize: vertical;
            height: 80px;
        }
        
        .form-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }
        
        .btn-secondary {
            padding: 0.75rem 1.5rem;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .btn-primary {
            padding: 0.75rem 1.5rem;
            border: none;
            background: #0066cc;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: #0066cc;
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .summary-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .summary-content h3 {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }
        
        .summary-number {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.3rem;
        }
        
        .summary-change {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .summary-change.positive { color: #059669; }
        .summary-change.negative { color: #dc2626; }
        .summary-change.neutral { color: #64748b; }
        
        .charts-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .chart-container.large {
            grid-column: span 2;
        }
        
        .chart-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chart-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0;
        }
        
        .chart-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .chart-filter,
        .search-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .search-input {
            width: 200px;
        }
        
        .chart-content {
            padding: 1.5rem;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
        }
        
        .report-table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
        }
        
        .table-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .action-btn {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: #f8fafc;
            border-color: #0066cc;
            color: #0066cc;
        }
        
        .action-btn.add { color: #059669; border-color: #059669; }
        .action-btn.add:hover { background: #f0fdf4; }
        
        .action-btn.delete { color: #dc2626; border-color: #dc2626; }
        .action-btn.delete:hover { background: #fef2f2; }
        
        .report-table-wrapper {
            overflow-x: auto;
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .report-table th,
        .report-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .report-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }
        
        .report-table th:first-child,
        .report-table td:first-child {
            width: 40px;
            text-align: center;
        }
        
        .row-checkbox {
            cursor: pointer;
        }
        
        .epic-row {
            background: #f8fafc;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .epic-row:hover {
            background: #f1f5f9;
        }
        
        .epic-header {
            font-weight: 600;
            color: #1e293b;
        }
        
        .epic-toggle {
            margin-right: 0.5rem;
            transition: transform 0.2s ease;
        }
        
        .epic-toggle.expanded {
            transform: rotate(90deg);
        }
        
        .epic-children {
            display: none;
        }
        
        .epic-children.expanded {
            display: table-row-group;
        }
        
        .child-row {
            background: #fefefe;
        }
        
        .child-row td:nth-child(2) {
            padding-left: 2rem;
        }
        
        .epic-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-right: 0.5rem;
        }
        
        .epic-process { background: #dbeafe; color: #1d4ed8; }
        .epic-personnel { background: #d1fae5; color: #065f46; }
        .epic-epr { background: #fee2e2; color: #991b1b; }
        .epic-planning { background: #fef3c7; color: #92400e; }
        
        .assignee {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #0066cc;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .priority-badge,
        .status-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .priority-badge.high { background: #fee2e2; color: #dc2626; }
        .priority-badge.medium { background: #fef3c7; color: #d97706; }
        .priority-badge.low { background: #d1fae5; color: #059669; }
        
        .status-badge.todo { background: #f3f4f6; color: #374151; }
        .status-badge.progress { background: #fef3c7; color: #d97706; }
        .status-badge.done { background: #d1fae5; color: #059669; }
        
        .progress-bar {
            width: 80px;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #0066cc;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 500;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
        }
        
        .sprint-details {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .sprint-card {
            padding: 1.5rem;
        }
        
        .sprint-card h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
        }
        
        .sprint-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .badge {
            background: #dbeafe;
            color: #1d4ed8;
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .sprint-sections {
            display: grid;
            gap: 1.5rem;
        }
        
        .sprint-section h5 {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        .sprint-section p {
            color: #374151;
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }
        
        .retro-section {
            margin-bottom: 1rem;
        }
        
        .retro-section ul {
            margin-left: 1rem;
            color: #374151;
        }
        
        .retro-section li {
            margin-bottom: 0.3rem;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .sidebar-toggle {
                display: block;
            }
        }

        /* Additional styles for form improvements */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .task-details {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .detail-label {
            font-weight: 500;
            color: #374151;
        }

        .detail-value {
            color: #64748b;
        }
    </style>
</head>
<body>
    <!-- Sidebar Toggle for Mobile -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>TaskBoard</h1>
            <div class="subtitle">SHE Department</div>
            <div class="system-info">ExxonMobil</div>
        </div>
        
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Functions</div>
                <div class="nav-item active" data-function="process-safety">
                    <span class="nav-item-icon"><i class="fas fa-cogs"></i></span>
                    Process Safety
                    <span class="nav-item-count">8</span>
                </div>
                <div class="nav-item" data-function="personnel-safety">
                    <span class="nav-item-icon"><i class="fas fa-hard-hat"></i></span>
                    Personnel Safety
                    <span class="nav-item-count">6</span>
                </div>
                <div class="nav-item" data-function="epr">
                    <span class="nav-item-icon"><i class="fas fa-exclamation-triangle"></i></span>
                    EP&R
                    <span class="nav-item-count">4</span>
                </div>
                <div class="nav-item" data-function="planning">
                    <span class="nav-item-icon"><i class="fas fa-calendar-alt"></i></span>
                    Planning
                    <span class="nav-item-count">5</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Management</div>
                <div class="nav-item" onclick="showReports()">
                    <span class="nav-item-icon"><i class="fas fa-chart-bar"></i></span>
                    Reports
                </div>
                <div class="nav-item" onclick="showTeam()">
                    <span class="nav-item-icon"><i class="fas fa-users"></i></span>
                    Team Members
                </div>
                <div class="nav-item" onclick="showCalendar()">
                    <span class="nav-item-icon"><i class="fas fa-calendar"></i></span>
                    Calendar
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Settings</div>
                <div class="nav-item" onclick="showSettings()">
                    <span class="nav-item-icon"><i class="fas fa-cog"></i></span>
                    Settings
                </div>
                <div class="nav-item" onclick="showProfile()">
                    <span class="nav-item-icon"><i class="fas fa-user"></i></span>
                    Profile
                </div>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <header class="header">
            <h1 id="currentFunctionTitle">Process Safety</h1>
            <div class="subtitle">Manage tasks and track progress</div>
        </header>

        <nav class="nav-tabs">
            <ul class="tab-list">
                <li class="tab-item active" data-status="all">
                    <span class="tab-icon"><i class="fas fa-list"></i></span>
                    All Tasks
                </li>
                <li class="tab-item" data-status="todo">
                    <span class="tab-icon"><i class="fas fa-clock"></i></span>
                    To Do
                </li>
                <li class="tab-item" data-status="progress">
                    <span class="tab-icon"><i class="fas fa-spinner"></i></span>
                    In Progress
                </li>
                <li class="tab-item" data-status="done">
                    <span class="tab-icon"><i class="fas fa-check-circle"></i></span>
                    Done
                </li>
            </ul>
        </nav>

    <div class="container">
        <!-- Process Safety Section -->
        <div id="process-safety" class="function-section active">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-cogs"></i>
                    Process Safety
                </h2>
                <button class="create-task-btn" onclick="openCreateTaskModal('process-safety')">
                    <i class="fas fa-plus"></i>
                    Create Task
                </button>
            </div>

            <div class="kanban-board">
                <div class="kanban-column">
                    <div class="column-header todo-header">Todo</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-story">Story 1</div>
                        <div class="task-title">HAZOP Study for New Process Unit</div>
                        <div class="task-meta">
                            <span class="task-priority priority-high">High Priority</span>
                            <span>Due: Dec 15</span>
                        </div>
                    </div>
                    <div class="task-card">
                        <div class="task-type-badge badge-spike">Spike 1</div>
                        <div class="task-title">Risk Assessment Documentation</div>
                        <div class="task-meta">
                            <span class="task-priority priority-medium">Medium Priority</span>
                            <span>Due: Dec 20</span>
                        </div>
                    </div>
                </div>

                <div class="kanban-column">
                    <div class="column-header progress-header">In Progress</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-sprint">Sprint 2</div>
                        <div class="task-title">Process Safety Management System Update</div>
                        <div class="task-meta">
                            <span class="task-priority priority-high">High Priority</span>
                            <span>Due: Dec 18</span>
                        </div>
                    </div>
                </div>

                <div class="kanban-column">
                    <div class="column-header done-header">Done</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-qa">QA Docs 1</div>
                        <div class="task-title">Safety Instrumented System Review</div>
                        <div class="task-meta">
                            <span class="task-priority priority-medium">Medium Priority</span>
                            <span>Completed</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="team-performance">
                <h3 class="performance-header">
                    <i class="fas fa-chart-line"></i>
                    Team Performance
                </h3>
                <div class="empty-state">
                    <div class="icon"><i class="fas fa-chart-bar"></i></div>
                    <p>No team members assigned yet</p>
                    <p>Add some tasks to see performance metrics</p>
                </div>
            </div>
        </div>

        <!-- Personnel Safety Section -->
        <div id="personnel-safety" class="function-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-hard-hat"></i>
                    Personnel Safety & Human Performance
                </h2>
                <button class="create-task-btn" onclick="openCreateTaskModal('personnel-safety')">
                    <i class="fas fa-plus"></i>
                    Create Task
                </button>
            </div>

            <div class="kanban-board">
                <div class="kanban-column">
                    <div class="column-header todo-header">Todo</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-story">Story 2</div>
                        <div class="task-title">Behavior Based Safety Audit</div>
                        <div class="task-meta">
                            <span class="task-priority priority-high">High Priority</span>
                            <span>Due: Dec 16</span>
                        </div>
                    </div>
                    <div class="task-card">
                        <div class="task-type-badge badge-sprint">Sprint 1</div>
                        <div class="task-title">Safety Training Program Update</div>
                        <div class="task-meta">
                            <span class="task-priority priority-medium">Medium Priority</span>
                            <span>Due: Dec 22</span>
                        </div>
                    </div>
                </div>

                <div class="kanban-column">
                    <div class="column-header progress-header">In Progress</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-spike">Spike 2</div>
                        <div class="task-title">Human Factors Analysis Study</div>
                        <div class="task-meta">
                            <span class="task-priority priority-high">High Priority</span>
                            <span>Due: Dec 19</span>
                        </div>
                    </div>
                </div>

                <div class="kanban-column">
                    <div class="column-header done-header">Done</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-qa">QA Docs 2</div>
                        <div class="task-title">PPE Compliance Assessment</div>
                        <div class="task-meta">
                            <span class="task-priority priority-low">Low Priority</span>
                            <span>Completed</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="team-performance">
                <h3 class="performance-header">
                    <i class="fas fa-chart-line"></i>
                    Team Performance
                </h3>
                <div class="empty-state">
                    <div class="icon"><i class="fas fa-chart-bar"></i></div>
                    <p>No team members assigned yet</p>
                    <p>Add some tasks to see performance metrics</p>
                </div>
            </div>
        </div>

        <!-- EP&R Section -->
        <div id="epr" class="function-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Emergency Preparedness & Response
                </h2>
                <button class="create-task-btn" onclick="openCreateTaskModal('epr')">
                    <i class="fas fa-plus"></i>
                    Create Task
                </button>
            </div>

            <div class="kanban-board">
                <div class="kanban-column">
                    <div class="column-header todo-header">Todo</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-story">Story 3</div>
                        <div class="task-title">Emergency Response Plan Review</div>
                        <div class="task-meta">
                            <span class="task-priority priority-high">High Priority</span>
                            <span>Due: Dec 17</span>
                        </div>
                    </div>
                </div>

                <div class="kanban-column">
                    <div class="column-header progress-header">In Progress</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-sprint">Sprint 3</div>
                        <div class="task-title">Crisis Management Drill</div>
                        <div class="task-meta">
                            <span class="task-priority priority-medium">Medium Priority</span>
                            <span>Due: Dec 21</span>
                        </div>
                    </div>
                </div>

                <div class="kanban-column">
                    <div class="column-header done-header">Done</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-qa">QA Docs 3</div>
                        <div class="task-title">Emergency Equipment Check</div>
                        <div class="task-meta">
                            <span class="task-priority priority-low">Low Priority</span>
                            <span>Completed</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="team-performance">
                <h3 class="performance-header">
                    <i class="fas fa-chart-line"></i>
                    Team Performance
                </h3>
                <div class="empty-state">
                    <div class="icon"><i class="fas fa-chart-bar"></i></div>
                    <p>No team members assigned yet</p>
                    <p>Add some tasks to see performance metrics</p>
                </div>
            </div>
        </div>

        <!-- Planning Section -->
        <div id="planning" class="function-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-calendar-alt"></i>
                    Planning
                </h2>
                <button class="create-task-btn" onclick="openCreateTaskModal('planning')">
                    <i class="fas fa-plus"></i>
                    Create Task
                </button>
            </div>

            <div class="kanban-board">
                <div class="kanban-column">
                    <div class="column-header todo-header">Todo</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-spike">Spike 3</div>
                        <div class="task-title">Annual SHE Strategy Review</div>
                        <div class="task-meta">
                            <span class="task-priority priority-high">High Priority</span>
                            <span>Due: Dec 30</span>
                        </div>
                    </div>
                </div>

                <div class="kanban-column">
                    <div class="column-header progress-header">In Progress</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-story">Story 4</div>
                        <div class="task-title">Resource Allocation Planning</div>
                        <div class="task-meta">
                            <span class="task-priority priority-medium">Medium Priority</span>
                            <span>Due: Dec 25</span>
                        </div>
                    </div>
                </div>

                <div class="kanban-column">
                    <div class="column-header done-header">Done</div>
                    <div class="task-card">
                        <div class="task-type-badge badge-qa">QA Docs 4</div>
                        <div class="task-title">Q4 Performance Metrics</div>
                        <div class="task-meta">
                            <span class="task-priority priority-low">Low Priority</span>
                            <span>Completed</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="team-performance">
                <h3 class="performance-header">
                    <i class="fas fa-chart-line"></i>
                    Team Performance
                </h3>
                <div class="empty-state">
                    <div class="icon"><i class="fas fa-chart-bar"></i></div>
                    <p>No team members assigned yet</p>
                    <p>Add some tasks to see performance metrics</p>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="function-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar"></i>
                    Reports & Analytics
                </h2>
                <div style="display: flex; gap: 1rem;">
                    <button class="create-task-btn" onclick="exportReport()" style="background: #059669;">
                        <i class="fas fa-download"></i>
                        Export Report
                    </button>
                    <button class="create-task-btn" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card">
                    <div class="summary-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="summary-content">
                        <h3>Total Tasks</h3>
                        <p class="summary-number">48</p>
                        <span class="summary-change positive">+12% this month</span>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="summary-content">
                        <h3>Completed</h3>
                        <p class="summary-number">32</p>
                        <span class="summary-change positive">+8% this month</span>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="summary-content">
                        <h3>In Progress</h3>
                        <p class="summary-number">12</p>
                        <span class="summary-change neutral">Same as last month</span>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="summary-content">
                        <h3>Overdue</h3>
                        <p class="summary-number">4</p>
                        <span class="summary-change negative">+2 from last month</span>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="charts-row">
                <!-- Gantt Chart -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-calendar-alt"></i> Project Timeline - Gantt Chart</h3>
                        <div class="chart-controls">
                            <select class="chart-filter">
                                <option>All Functions</option>
                                <option>Process Safety</option>
                                <option>Personnel Safety</option>
                                <option>EP&R</option>
                                <option>Planning</option>
                            </select>
                        </div>
                    </div>
                    <div id="ganttChart" class="chart-content"></div>
                </div>

                <!-- Progress Pie Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3><i class="fas fa-pie-chart"></i> Progress by Function</h3>
                    </div>
                    <div id="pieChart" class="chart-content"></div>
                </div>
            </div>

            <!-- Performance Bar Chart -->
            <div class="charts-row">
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-bar"></i> Performance by Assignee</h3>
                        <div class="chart-controls">
                            <select class="chart-filter">
                                <option>This Month</option>
                                <option>Last Month</option>
                                <option>This Quarter</option>
                                <option>This Year</option>
                            </select>
                        </div>
                    </div>
                    <div id="barChart" class="chart-content"></div>
                </div>
            </div>

            <!-- Main Report Table -->
            <div class="report-table-container">
                <div class="chart-header">
                    <h3><i class="fas fa-table"></i> Main Report - Task Details</h3>
                    <div class="chart-controls">
                        <input type="text" placeholder="Search tasks..." class="search-input" id="searchInput">
                        <select class="chart-filter" id="statusFilter">
                            <option>All Status</option>
                            <option>Todo</option>
                            <option>In Progress</option>
                            <option>Done</option>
                            <option>Overdue</option>
                        </select>
                        <div class="table-actions">
                            <button class="action-btn add" onclick="addNewRow()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                            <button class="action-btn" onclick="editSelectedRows()">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete" onclick="deleteSelectedRows()">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
                <div class="report-table-wrapper">
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th>Epic</th>
                                <th>Task Name</th>
                                <th>Assignee</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Last Updated</th>
                                <th>Created By</th>
                                <th>Due Date</th>
                                <th>Progress</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="epic-row" onclick="toggleEpic('epic1')">
                                <td>
                                    <input type="checkbox" class="row-checkbox" onclick="event.stopPropagation()">
                                </td>
                                <td colspan="9" class="epic-header">
                                    <i class="fas fa-chevron-right epic-toggle" id="toggle-epic1"></i>
                                    <span class="epic-badge epic-process">Process Safety</span>
                                    Epic 1: Pengembangan Tempat Warga Darurat Geometrik
                                </td>
                            </tr>
                            <tbody class="epic-children" id="epic1-children">
                                <tr class="child-row">
                                    <td>
                                        <input type="checkbox" class="row-checkbox">
                                    </td>
                                    <td></td>
                                    <td>HAZOP Study Implementation</td>
                                    <td>
                                        <div class="assignee">
                                            <span class="avatar">LA</span>
                                            Lee Alya
                                        </div>
                                    </td>
                                    <td><span class="priority-badge high">High</span></td>
                                    <td><span class="status-badge done">DONE</span></td>
                                    <td>Dec 10, 2024</td>
                                    <td>
                                        <div class="assignee">
                                            <span class="avatar">LA</span>
                                            Lee Alya
                                        </div>
                                    </td>
                                    <td>Dec 15, 2024</td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 100%;"></div>
                                            <span class="progress-text">100%</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="child-row">
                                    <td>
                                        <input type="checkbox" class="row-checkbox">
                                    </td>
                                    <td></td>
                                    <td>Risk Assessment Framework</td>
                                    <td>
                                        <div class="assignee">
                                            <span class="avatar">LA</span>
                                            Lee Alya
                                        </div>
                                    </td>
                                    <td><span class="priority-badge high">High</span></td>
                                    <td><span class="status-badge progress">IN PROGRESS</span></td>
                                    <td>Dec 11, 2024</td>
                                    <td>
                                        <div class="assignee">
                                            <span class="avatar">LA</span>
                                            Lee Alya
                                        </div>
                                    </td>
                                    <td>Dec 18, 2024</td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 65%;"></div>
                                            <span class="progress-text">65%</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            
                            <tr class="epic-row" onclick="toggleEpic('epic2')">
                                <td>
                                    <input type="checkbox" class="row-checkbox" onclick="event.stopPropagation()">
                                </td>
                                <td colspan="9" class="epic-header">
                                    <i class="fas fa-chevron-right epic-toggle" id="toggle-epic2"></i>
                                    <span class="epic-badge epic-personnel">Personnel Safety</span>
                                    Epic 2: Behavior Based Safety Program
                                </td>
                            </tr>
                            <tbody class="epic-children" id="epic2-children">
                                <tr class="child-row">
                                    <td>
                                        <input type="checkbox" class="row-checkbox">
                                    </td>
                                    <td></td>
                                    <td>Safety Training Enhancement</td>
                                    <td>
                                        <div class="assignee">
                                            <span class="avatar">JD</span>
                                            John Doe
                                        </div>
                                    </td>
                                    <td><span class="priority-badge medium">Medium</span></td>
                                    <td><span class="status-badge todo">TODO</span></td>
                                    <td>Dec 8, 2024</td>
                                    <td>
                                        <div class="assignee">
                                            <span class="avatar">LA</span>
                                            Lee Alya
                                        </div>
                                    </td>
                                    <td>Dec 22, 2024</td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 25%;"></div>
                                            <span class="progress-text">25%</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            
                            <tr class="epic-row" onclick="toggleEpic('epic3')">
                                <td>
                                    <input type="checkbox" class="row-checkbox" onclick="event.stopPropagation()">
                                </td>
                                <td colspan="9" class="epic-header">
                                    <i class="fas fa-chevron-right epic-toggle" id="toggle-epic3"></i>
                                    <span class="epic-badge epic-epr">EP&R</span>
                                    Epic 3: Emergency Response System
                                </td>
                            </tr>
                            <tbody class="epic-children" id="epic3-children">
                                <tr class="child-row">
                                    <td>
                                        <input type="checkbox" class="row-checkbox">
                                    </td>
                                    <td></td>
                                    <td>Crisis Management Drill</td>
                                    <td>
                                        <div class="assignee">
                                            <span class="avatar">SM</span>
                                            Sarah Miller
                                        </div>
                                    </td>
                                    <td><span class="priority-badge high">High</span></td>
                                    <td><span class="status-badge progress">IN PROGRESS</span></td>
                                    <td>Dec 9, 2024</td>
                                    <td>
                                        <div class="assignee">
                                            <span class="avatar">LA</span>
                                            Lee Alya
                                        </div>
                                    </td>
                                    <td>Dec 21, 2024</td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 40%;"></div>
                                            <span class="progress-text">40%</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sprint Details -->
            <div class="sprint-details">
                <div class="chart-header">
                    <h3><i class="fas fa-rocket"></i> Current Sprint Details</h3>
                </div>
                <div class="sprint-info">
                    <div class="sprint-card">
                        <h4>Sprint 4: SHE System Integration & API Development</h4>
                        <div class="sprint-meta">
                            <span><strong>Type:</strong> <span class="badge">Sprint</span></span>
                            <span><strong>Sub-sprints:</strong> 4</span>
                            <span><strong>Created By:</strong> Lee Alya</span>
                            <span><strong>QA Analyst:</strong> Lee Alya</span>
                        </div>
                        <div class="sprint-sections">
                            <div class="sprint-section">
                                <h5><i class="fas fa-bullseye"></i> Goal</h5>
                                <p>Menyelesaikan pengembangan pengaman dengan menambahkan fitur interaktif. Tujuannya adalah membentuk dan mengingtegrasikan API pengalaman yang menambahkan pengalaman bentuknya diantaranya bertemu dengan sistem kontroler.</p>
                            </div>
                            <div class="sprint-section">
                                <h5><i class="fas fa-history"></i> Retrospective</h5>
                                <div class="retro-section">
                                    <p><strong>Apa yang berjalan baik:</strong></p>
                                    <ul>
                                        <li>Tim berhasil melanjut bekerja dengan baik, bapat Scrum API  terdokumentasikan >mengingtegrasikan ke SLA. Proses berjalan sangat efisien.</li>
                                        <li>API percakapan berhasil memberikan response yang stalom pada penggunaan email.</li>
                                    </ul>
                                </div>
                                <div class="retro-section">
                                    <p><strong>Apa yang berjalan buruk:</strong></p>
                                    <ul>
                                        <li>Tim berhasil membuat Chat interface terpadu akan tetapi interface tidak memberikan template response UI backend perangkat.</li>
                                        <li>Response dual API percakapan terkadang lambat pada yang optimasi di sprint berikutnya.</li>
                                    </ul>
                                </div>
                                <div class="retro-section">
                                    <p><strong>Apa yang dapat diperbaiki:</strong></p>
                                    <ul>
                                        <li>Lebih terfokus saat daily scrum</li>
                                        <li>Manajemen github dan kloak</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="sprint-section">
                                <h5><i class="fas fa-clipboard-check"></i> Review</h5>
                                <ul>
                                    <li>API Percakapan API untuk menyatukkan input perangakat dan memberikan response berkerja ada internal dilakukan task, defektif, dan di-validasi ke lingkungan <span style="color: #059669;">PRO</span>.</li>
                                    <li>UI Desain Dashboard: Halaman untuk menampilkan informasi akurat dan agar distribusi lebih validasi dataset.</li>
                                    <li>Integrasi Fitur Percakapan: Chat unit atau percakapan bukhadi yang mengkomunikasikan di halaman desain dashboard dengan berbicara dengan API percakapan.</li>
                                    <li>Pengembangan Ekskalibilitas: Error handling di api frontend/intalling atau API dapat merespon hasil perubahan yang stabil.</li>
                                    <li>Pengujian Otomatik: Automated testing untuk halaman detail dari operasi dan fungsi-otolitas yang perkulahan bukan validasi difokus.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- End main-content -->

    <!-- Create Task Modal -->
    <div id="createTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Task</h3>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Task Title</label>
                    <input type="text" class="form-input" id="taskTitle" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="taskDescription"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Task Type</label>
                        <select class="form-select" id="taskType" onchange="updateTaskSubtype()">
                            <option value="">Select Type</option>
                            <option value="spike">Spike</option>
                            <option value="story">Story</option>
                            <option value="sprint">Sprint</option>
                            <option value="qa">QA Docs</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Sub-type</label>
                        <select class="form-select" id="taskSubtype" disabled>
                            <option value="">Select sub-type</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <select class="form-select" id="taskPriority">
                            <option value="high">High Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="taskStatus">
                            <option value="todo">To Do</option>
                            <option value="progress">In Progress</option>
                            <option value="done">Done</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" class="form-input" id="taskDueDate">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Assigned To</label>
                        <input type="text" class="form-input" id="taskAssignee" placeholder="Enter team member name">
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentFunction = 'process-safety';
        let selectedRows = [];

        // Sidebar navigation functionality
        document.querySelectorAll('.sidebar .nav-item[data-function]').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all sidebar items
                document.querySelectorAll('.sidebar .nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('.function-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked item
                this.classList.add('active');
                currentFunction = this.getAttribute('data-function');
                
                // Show corresponding section
                document.getElementById(currentFunction).classList.add('active');
                
                // Update header title
                const titles = {
                    'process-safety': 'Process Safety',
                    'personnel-safety': 'Personnel Safety & Human Performance',
                    'epr': 'Emergency Preparedness & Response',
                    'planning': 'Planning'
                };
                document.getElementById('currentFunctionTitle').textContent = titles[currentFunction];
            });
        });

        // Mobile sidebar toggle
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Additional navigation functions
        function showReports() {
            // Remove active class from all sidebar items and sections
            document.querySelectorAll('.sidebar .nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelectorAll('.function-section').forEach(s => s.classList.remove('active'));
            
            // Show reports section
            document.getElementById('reports').classList.add('active');
            
            // Update header title
            document.getElementById('currentFunctionTitle').textContent = 'Reports & Analytics';
            
            // Initialize charts
            setTimeout(() => {
                initializeCharts();
            }, 100);
        }

        function showTeam() {
            alert('Team management feature coming soon!');
        }

        function showCalendar() {
            alert('Calendar feature coming soon!');
        }

        function showSettings() {
            alert('Settings feature coming soon!');
        }

        function showProfile() {
            alert('Profile feature coming soon!');
        }

        // Tab switching functionality (for status filtering)
        document.querySelectorAll('.tab-item[data-status]').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                document.querySelectorAll('.tab-item[data-status]').forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                const status = this.getAttribute('data-status');
                filterTasksByStatus(status);
            });
        });

        function filterTasksByStatus(status) {
            const columns = document.querySelectorAll('.kanban-column');
            
            if (status === 'all') {
                columns.forEach(col => col.style.display = 'block');
            } else {
                columns.forEach((col, index) => {
                    if (
                        (status === 'todo' && index % 3 === 0) ||
                        (status === 'progress' && index % 3 === 1) ||
                        (status === 'done' && index % 3 === 2)
                    ) {
                        col.style.display = 'block';
                    } else {
                        col.style.display = 'none';
                    }
                });
            }
        }

        // Modal functionality
        function openCreateTaskModal(functionName) {
            currentFunction = functionName;
            document.getElementById('createTaskModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('createTaskModal').style.display = 'none';
            document.getElementById('taskForm').reset();
            document.getElementById('taskSubtype').disabled = true;
            document.getElementById('taskSubtype').innerHTML = '<option value="">Select sub-type</option>';
        }

        // Task type and subtype functionality
        function updateTaskSubtype() {
            const taskType = document.getElementById('taskType').value;
            const subtypeSelect = document.getElementById('taskSubtype');
            
            subtypeSelect.innerHTML = '<option value="">Select sub-type</option>';
            
            if (taskType) {
                subtypeSelect.disabled = false;
                
                for (let i = 1; i <= 3; i++) {
                    const option = document.createElement('option');
                    option.value = `${taskType}-${i}`;
                    option.textContent = `${taskType.charAt(0).toUpperCase() + taskType.slice(1)} ${i}`;
                    subtypeSelect.appendChild(option);
                }
            } else {
                subtypeSelect.disabled = true;
            }
        }

        // Create task form submission
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value;
            const priority = document.getElementById('taskPriority').value;
            const status = document.getElementById('taskStatus').value;
            const dueDate = document.getElementById('taskDueDate').value;
            const taskType = document.getElementById('taskType').value;
            const taskSubtype = document.getElementById('taskSubtype').value;
            
            // Create new task card
            const taskCard = document.createElement('div');
            taskCard.className = 'task-card';
            taskCard.innerHTML = `
                <div class="task-type-badge badge-${taskType}">${taskSubtype ? taskSubtype.replace('-', ' ').toUpperCase() : taskType.toUpperCase()}</div>
                <div class="task-title">${title}</div>
                <div class="task-meta">
                    <span class="task-priority priority-${priority}">${priority.charAt(0).toUpperCase() + priority.slice(1)} Priority</span>
                    <span>Due: ${new Date(dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                </div>
            `;
            
            // Add to appropriate column based on status
            const columns = document.querySelectorAll(`#${currentFunction} .kanban-column`);
            let targetColumn;
            
            switch(status) {
                case 'todo':
                    targetColumn = columns[0];
                    break;
                case 'progress':
                    targetColumn = columns[1];
                    break;
                case 'done':
                    targetColumn = columns[2];
                    break;
            }
            
            if (targetColumn) {
                targetColumn.appendChild(taskCard);
                addDragFunctionality(taskCard);
            }
            
            closeModal();
        });

        // Table functionality
        function toggleEpic(epicId) {
            const toggle = document.getElementById(`toggle-${epicId}`);
            const children = document.getElementById(`${epicId}-children`);
            
            if (children.classList.contains('expanded')) {
                children.classList.remove('expanded');
                toggle.classList.remove('expanded');
                children.style.display = 'none';
            } else {
                children.classList.add('expanded');
                toggle.classList.add('expanded');
                children.style.display = 'table-row-group';
            }
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.row-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            updateSelectedRows();
        }

        function updateSelectedRows() {
            selectedRows = Array.from(document.querySelectorAll('.row-checkbox:checked'))
                .map(checkbox => checkbox.closest('tr'));
        }

        // Add event listeners to checkboxes
        document.querySelectorAll('.row-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedRows);
        });

        function addNewRow() {
            // For now, just open the create task modal
            openCreateTaskModal(currentFunction);
        }

        function editSelectedRows() {
            if (selectedRows.length === 0) {
                alert('Please select rows to edit');
                return;
            }
            alert(`Editing ${selectedRows.length} selected rows - Feature coming soon!`);
        }

        function deleteSelectedRows() {
            if (selectedRows.length === 0) {
                alert('Please select rows to delete');
                return;
            }
            
            if (confirm(`Are you sure you want to delete ${selectedRows.length} selected rows?`)) {
                selectedRows.forEach(row => {
                    if (row && row.parentNode) {
                        row.parentNode.removeChild(row);
                    }
                });
                selectedRows = [];
                document.getElementById('selectAll').checked = false;
            }
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('.report-table tbody tr:not(.epic-row)');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Status filter functionality
        document.getElementById('statusFilter').addEventListener('change', function(e) {
            const filterValue = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('.report-table tbody tr:not(.epic-row)');
            
            rows.forEach(row => {
                if (filterValue === 'all status' || filterValue === '') {
                    row.style.display = '';
                } else {
                    const statusBadge = row.querySelector('.status-badge');
                    if (statusBadge && statusBadge.textContent.toLowerCase().includes(filterValue)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        });

        // Drag and drop functionality
        function addDragFunctionality(taskCard) {
            taskCard.draggable = true;
            
            taskCard.addEventListener('dragstart', function(e) {
                e.dataTransfer.setData('text/plain', '');
                taskCard.classList.add('dragging');
            });
            
            taskCard.addEventListener('dragend', function() {
                taskCard.classList.remove('dragging');
            });
        }

        // Add drag functionality to existing tasks
        document.querySelectorAll('.task-card').forEach(addDragFunctionality);

        // Column drop functionality
        document.querySelectorAll('.kanban-column').forEach(column => {
            column.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            column.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            column.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const draggingTask = document.querySelector('.dragging');
                if (draggingTask) {
                    this.appendChild(draggingTask);
                }
            });
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('createTaskModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // Initialize charts function
        function initializeCharts() {
            initializeGanttChart();
            initializePieChart();
            initializeBarChart();
        }

        function initializeGanttChart() {
            const ganttChart = document.getElementById('ganttChart');
            ganttChart.innerHTML = `
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 1rem;">
                    <div style="width: 100%; max-width: 800px;">
                        <div class="gantt-timeline">
                            <div class="gantt-header">
                                <div class="gantt-task-column">Tasks</div>
                                <div class="gantt-dates">
                                    <div class="gantt-date">Dec 1</div>
                                    <div class="gantt-date">Dec 8</div>
                                    <div class="gantt-date">Dec 15</div>
                                    <div class="gantt-date">Dec 22</div>
                                    <div class="gantt-date">Dec 29</div>
                                </div>
                            </div>
                            <div class="gantt-body">
                                <div class="gantt-row">
                                    <div class="gantt-task-name">HAZOP Study</div>
                                    <div class="gantt-timeline-row">
                                        <div class="gantt-bar gantt-done" style="left: 20%; width: 30%;"></div>
                                    </div>
                                </div>
                                <div class="gantt-row">
                                    <div class="gantt-task-name">Risk Assessment</div>
                                    <div class="gantt-timeline-row">
                                        <div class="gantt-bar gantt-progress" style="left: 40%; width: 25%;"></div>
                                    </div>
                                </div>
                                <div class="gantt-row">
                                    <div class="gantt-task-name">Safety Training</div>
                                    <div class="gantt-timeline-row">
                                        <div class="gantt-bar gantt-todo" style="left: 60%; width: 35%;"></div>
                                    </div>
                                </div>
                                <div class="gantt-row">
                                    <div class="gantt-task-name">Emergency Drill</div>
                                    <div class="gantt-timeline-row">
                                        <div class="gantt-bar gantt-progress" style="left: 30%; width: 40%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Add Gantt Chart styles
            const ganttStyles = `
                <style>
                .gantt-timeline { border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
                .gantt-header { display: flex; background: #f8fafc; border-bottom: 2px solid #e2e8f0; }
                .gantt-task-column { width: 200px; padding: 1rem; font-weight: 600; border-right: 1px solid #e2e8f0; }
                .gantt-dates { flex: 1; display: flex; }
                .gantt-date { flex: 1; padding: 1rem; text-align: center; font-size: 0.9rem; font-weight: 500; border-right: 1px solid #e2e8f0; }
                .gantt-date:last-child { border-right: none; }
                .gantt-body { }
                .gantt-row { display: flex; border-bottom: 1px solid #e2e8f0; }
                .gantt-row:last-child { border-bottom: none; }
                .gantt-task-name { width: 200px; padding: 1rem; border-right: 1px solid #e2e8f0; display: flex; align-items: center; }
                .gantt-timeline-row { flex: 1; position: relative; height: 50px; }
                .gantt-bar { position: absolute; top: 50%; transform: translateY(-50%); height: 20px; border-radius: 10px; }
                .gantt-done { background: #10b981; }
                .gantt-progress { background: #f59e0b; }
                .gantt-todo { background: #ef4444; }
                </style>
            `;
            
            if (!document.querySelector('#gantt-styles')) {
                const styleSheet = document.createElement('style');
                styleSheet.id = 'gantt-styles';
                styleSheet.innerHTML = ganttStyles;
                document.head.appendChild(styleSheet);
            }
        }

        function initializePieChart() {
            const pieChart = document.getElementById('pieChart');
            pieChart.innerHTML = `
                <div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <div class="pie-chart-container">
                        <svg width="200" height="200" viewBox="0 0 200 200">
                            <circle cx="100" cy="100" r="80" fill="none" stroke="#10b981" stroke-width="20" stroke-dasharray="125.6 251.2" transform="rotate(-90 100 100)"></circle>
                            <circle cx="100" cy="100" r="80" fill="none" stroke="#f59e0b" stroke-width="20" stroke-dasharray="94.2 251.2" stroke-dashoffset="-125.6" transform="rotate(-90 100 100)"></circle>
                            <circle cx="100" cy="100" r="80" fill="none" stroke="#ef4444" stroke-width="20" stroke-dasharray="62.8 251.2" stroke-dashoffset="-219.8" transform="rotate(-90 100 100)"></circle>
                            <circle cx="100" cy="100" r="80" fill="none" stroke="#6366f1" stroke-width="20" stroke-dasharray="31.4 251.2" stroke-dashoffset="-282.6" transform="rotate(-90 100 100)"></circle>
                        </svg>
                    </div>
                    <div class="pie-legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #10b981;"></span>
                            Process Safety (40%)
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #f59e0b;"></span>
                            Personnel Safety (30%)
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ef4444;"></span>
                            EP&R (20%)
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #6366f1;"></span>
                            Planning (10%)
                        </div>
                    </div>
                </div>
            `;

            // Add pie chart styles
            const pieStyles = `
                <style>
                .pie-chart-container { margin-bottom: 1rem; }
                .pie-legend { display: flex; flex-direction: column; gap: 0.5rem; }
                .legend-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
                .legend-color { width: 12px; height: 12px; border-radius: 2px; }
                </style>
            `;
            
            if (!document.querySelector('#pie-styles')) {
                const styleSheet = document.createElement('style');
                styleSheet.id = 'pie-styles';
                styleSheet.innerHTML = pieStyles;
                document.head.appendChild(styleSheet);
            }
        }

        function initializeBarChart() {
            const barChart = document.getElementById('barChart');
            barChart.innerHTML = `
                <div style="width: 100%; height: 100%; display: flex; align-items: end; justify-content: center; padding: 2rem;">
                    <div class="bar-chart-container">
                        <div class="bar-chart">
                            <div class="bar-group">
                                <div class="bar" style="height: 80%; background: #10b981;" data-value="24"></div>
                                <div class="bar-label">Lee Alya</div>
                            </div>
                            <div class="bar-group">
                                <div class="bar" style="height: 65%; background: #f59e0b;" data-value="18"></div>
                                <div class="bar-label">John Doe</div>
                            </div>
                            <div class="bar-group">
                                <div class="bar" style="height: 90%; background: #6366f1;" data-value="28"></div>
                                <div class="bar-label">Sarah Miller</div>
                            </div>
                            <div class="bar-group">
                                <div class="bar" style="height: 45%; background: #ef4444;" data-value="12"></div>
                                <div class="bar-label">Mike Johnson</div>
                            </div>
                            <div class="bar-group">
                                <div class="bar" style="height: 70%; background: #8b5cf6;" data-value="20"></div>
                                <div class="bar-label">Anna Smith</div>
                            </div>
                        </div>
                        <div class="chart-axis">
                            <span>0</span><span>10</span><span>20</span><span>30</span>
                        </div>
                    </div>
                </div>
            `;

            // Add bar chart styles
            const barStyles = `
                <style>
                .bar-chart-container { width: 100%; max-width: 600px; }
                .bar-chart { display: flex; align-items: end; gap: 2rem; height: 200px; margin-bottom: 1rem; }
                .bar-group { display: flex; flex-direction: column; align-items: center; flex: 1; }
                .bar { width: 40px; border-radius: 4px 4px 0 0; position: relative; transition: all 0.3s ease; cursor: pointer; }
                .bar:hover { opacity: 0.8; transform: translateY(-2px); }
                .bar::after { content: attr(data-value); position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 0.8rem; font-weight: 600; color: #374151; }
                .bar-label { margin-top: 0.5rem; font-size: 0.8rem; color: #64748b; text-align: center; }
                .chart-axis { display: flex; justify-content: space-between; padding: 0 20px; color: #64748b; font-size: 0.8rem; }
                </style>
            `;
            
            if (!document.querySelector('#bar-styles')) {
                const styleSheet = document.createElement('style');
                styleSheet.id = 'bar-styles';
                styleSheet.innerHTML = barStyles;
                document.head.appendChild(styleSheet);
            }
        }

        function exportReport() {
            alert('Export functionality will generate PDF/Excel report');
        }

        function refreshData() {
            // Simulate data refresh
            const btn = event.target.closest('button');
            const icon = btn.querySelector('i');
            
            icon.style.animation = 'spin 1s linear infinite';
            
            setTimeout(() => {
                icon.style.animation = '';
                alert('Data refreshed successfully!');
            }, 1500);
        }

        // Add CSS animation for refresh button
        const refreshStyles = `
            <style>
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            </style>
        `;
        
        if (!document.querySelector('#refresh-styles')) {
            const styleSheet = document.createElement('style');
            styleSheet.id = 'refresh-styles';
            styleSheet.innerHTML = refreshStyles;
            document.head.appendChild(styleSheet);
        }
    </script>
</body>
</html>